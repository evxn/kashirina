<!DOCTYPE html>
<html>
	<head>
		<META charset="UTF-8">
		<title>L-systems</title>
		<link href='http://fonts.googleapis.com/css?family=Titillium+Web:300' rel='stylesheet' type='text/css'>
		<style>
			body {
				font-size: 24px;
				font-family: "Titillium Web";
				font-weight: 300;
			}

			.field {
				margin-bottom: 0.5em;
				width : 900px;
				height : 450px;
				border: 2px solid black;
			}

			.button {
				display: block;
				margin-left: 23em;
				margin-bottom: 2em;
				padding: 0.3em;
				font-size: 1.2em;
				background-color: #FFF;
				border: 1px solid black;
				border-radius: 5px;
			}
		</style>
	</head>
	<body>
		<h1>L-система</h1>
		<canvas id='field' class="field" height="1000" width="2000" autofocus="autofocus"></canvas>
		<button type="button" onClick="drawStep();" class="button">Следующий шаг</button>
		<script type="text/javascript">
			var startX = 300;
			var startY = 300;
			var x,y;
			var tetta = Math.PI/4;
			var F = 10;
			//koch
			var axiom = "F++F++F++F";
			var newF = "F-F++F-F";
			var angle;
			var i;
			var canvas;
			var context;

			
			function init() {
				console.log("we are ready");
				console.log("axiom = " + axiom);
				console.log("newF = " + newF);
				canvas = document.getElementById("field");
				context = canvas.getContext('2d');
				context.lineWidth = 1;
			    x = startX;
			    y = startY;
			} 
			
			function drawStep() {
				canvas.width = canvas.width;
				x = startX;
			    y = startY;
			    angle = 0;
			    context.moveTo(x, y);
				for (i = 0; i < axiom.length; i++) {
					parseActionChar(axiom[i]);
				}
				context.stroke();	

				axiom = axiom.replace(/F/g, newF); 
				// console.log("new axiom = " + axiom);
			}
			
			
			function drawF() {
			   x += F*Math.cos(angle);
			   y += F*Math.sin(angle);
			   context.lineTo(x, y);
			}
		
			
			function parseActionChar(actionChar) {
				switch (actionChar) {
					case "F" : 
						drawF();
						break;
					case "+" :
						angle+=tetta;
						break;
					case "-" :
						angle-=tetta;
						break;
				}
			}
			
			document.addEventListener("DOMContentLoaded", init);
		</script>
	</body>
</html>